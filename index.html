<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProxyOmega Switcher</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f6f7fb;
            margin: 0;
            padding: 40px 16px;
            color: #1f2933;
        }
        .container {
            max-width: 720px;
            margin: 0 auto;
            background: #fff;
            border-radius: 12px;
            padding: 32px;
            box-shadow: 0 8px 24px rgba(15, 23, 42, 0.12);
        }
        h1 {
            margin-top: 0;
            font-size: 24px;
        }
        p {
            color: #52606d;
        }
        label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
        }
        input[type="text"] {
            width: 100%;
            padding: 12px 14px;
            font-size: 16px;
            border-radius: 8px;
            border: 1px solid #cbd2d9;
            box-sizing: border-box;
            margin-bottom: 16px;
        }
        button {
            background: #2563eb;
            border: none;
            color: #fff;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
        }
        button:disabled {
            background: #9fb7f5;
            cursor: not-allowed;
        }
        .error {
            background: #fee2e2;
            color: #991b1b;
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 16px;
        }
        .success {
            background: #dcfce7;
            color: #166534;
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 16px;
        }
        .actions {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }
        .json-preview {
            background: #0f172a;
            color: #e2e8f0;
            padding: 16px;
            border-radius: 8px;
            white-space: pre-wrap;
            font-size: 13px;
            overflow-x: auto;
            margin-top: 16px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Конвертер Proxy → Omega Switcher</h1>
        <p>Введите строку строго в формате <strong>username:password@host:port</strong>.</p>
        
        <div id="status"></div>
        <label for="proxy_input">Строка для парсинга</label>
        <input
            type="text"
            id="proxy_input"
            name="proxy_input"
            placeholder="user44115:oh054l@181.215.61.251:6378"
            required
        />
        <div class="actions">
            <button type="button" id="generate">Сгенерировать JSON</button>
            <button type="button" id="download" disabled>Скачать ProxyOmegaSwitcher.bak</button>
        </div>
        <div id="preview" class="json-preview" style="display: none;"></div>
    </div>

    <script>
        const generateButton = document.getElementById('generate');
        const downloadButton = document.getElementById('download');
        const input = document.getElementById('proxy_input');
        const status = document.getElementById('status');
        const preview = document.getElementById('preview');
        let currentJson = '';

        const pattern = /^([^:@\s]+):([^@\s]+)@([^:\s]+):(\d+)$/;

        function buildJson(username, password, host, port) {
            const payload = {
                "+auto switch": {
                    "color": "#99dd99",
                    "defaultProfileName": "direct",
                    "name": "auto switch",
                    "profileType": "SwitchProfile",
                    "rules": [
                        {
                            "condition": {
                                "conditionType": "HostWildcardCondition",
                                "pattern": "internal.example.com"
                            },
                            "profileName": "direct"
                        },
                        {
                            "condition": {
                                "conditionType": "HostWildcardCondition",
                                "pattern": "*.example.com"
                            },
                            "profileName": "proxy"
                        },
                        {
                            "condition": {
                                "conditionType": "HostWildcardCondition",
                                "pattern": "*.chatgpt.com"
                            },
                            "profileName": "proxy"
                        },
                        {
                            "condition": {
                                "conditionType": "HostWildcardCondition",
                                "pattern": "*.gosuslugi.ru"
                            },
                            "profileName": "direct"
                        }
                    ],
                    "revision": "19be1c9fd3c"
                },
                "+proxy": {
                    "bypassList": [
                        { "conditionType": "BypassCondition", "pattern": "127.0.0.1" },
                        { "conditionType": "BypassCondition", "pattern": "::1" },
                        { "conditionType": "BypassCondition", "pattern": "localhost" }
                    ],
                    "color": "#99ccee",
                    "fallbackProxy": {
                        "host": host,
                        "port": Number(port),
                        "scheme": "http"
                    },
                    "name": "proxy",
                    "profileType": "FixedProfile",
                    "revision": "19be1c5c9b3",
                    "auth": {
                        "fallbackProxy": {
                            "username": username,
                            "password": password
                        }
                    }
                },
                "-addConditionsToBottom": false,
                "-confirmDeletion": true,
                "-downloadInterval": 1440,
                "-enableQuickSwitch": false,
                "-quickSwitchProfiles": [],
                "-refreshOnProfileChange": true,
                "-revertProxyChanges": true,
                "-showExternalProfile": true,
                "-showInspectMenu": true,
                "-showResultProfileOnActionBadgeText": false,
                "-startupProfileName": "",
                "schemaVersion": 2,
                "-monitorWebRequests": true
            };

            return JSON.stringify(payload, null, 2);
        }

        function setStatus(message, type) {
            status.innerHTML = '';
            if (!message) {
                return;
            }
            const div = document.createElement('div');
            div.className = type === 'error' ? 'error' : 'success';
            div.textContent = message;
            status.appendChild(div);
        }

        generateButton.addEventListener('click', () => {
            const value = input.value.trim();
            const match = value.match(pattern);

            if (!match) {
                currentJson = '';
                preview.style.display = 'none';
                downloadButton.disabled = true;
                setStatus('Неверный формат. Пример: user44115:oh054l@181.215.61.251:6378', 'error');
                return;
            }

            const [, username, password, host, port] = match;
            currentJson = buildJson(username, password, host, port);
            preview.textContent = currentJson;
            preview.style.display = 'block';
            downloadButton.disabled = false;
            setStatus('JSON сформирован. Скачайте файл ProxyOmegaSwitcher.bak.', 'success');
        });

        downloadButton.addEventListener('click', () => {
            if (!currentJson) {
                return;
            }
            const blob = new Blob([currentJson], { type: 'application/json;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'ProxyOmegaSwitcher.bak';
            document.body.appendChild(link);
            link.click();
            link.remove();
            URL.revokeObjectURL(url);
        });
    </script>
</body>
</html>
